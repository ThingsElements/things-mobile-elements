<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->
<link rel="import" href="../../polymer/polymer.html">

<link rel="import" href="./things-mobile-list-meta-behavior.html">

<dom-module id="things-mobile-list">
  <template>
		<style>
			:host {
				display: block;
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			iron-list {
        /*padding-top: 64px;*/
        --iron-list-items-container: {
          display: block;
          margin: auto;
          /*margin-top: 60px;*/
          margin-bottom: 60px;
          border-bottom: 1px solid #ddd;
        };
      }

      .item {
        @apply(--layout-horizontal);
        padding:9px 5px 7px 5px;
        background-color: white;
        min-height:50px;
        border-bottom:1px solid #e4e4e4;
        cursor: pointer;
        margin-bottom: 10px;
      }

      .avatar {
        height: 40px;
        width: 40px;
        border-radius: 20px;
        box-sizing: border-box;
        background-color: #DDD;
      }

      .pad {
        padding: 0 10px;
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }

      .primary {
        font-size: 16px;
        color:#333
      }

      .shortText, .longText {
        padding-top:2px;
        font-size: 14px;
        color:#999
      }

      .longText {
        color: gray;
        display: none;
      }

      .item:hover .shortText::after {
        content: ' [+]';
        color: gray;
      }

      .item.expanded:hover .shortText::after {
        content: '';
      }

      .item.expanded .longText {
        display: block;
      }

      .item.expanded:hover .longText::after {
        content: ' [–]';
      }

      .spacer {
        @apply(--layout-flex);
      }

      iron-icon{
        opacity:.3;
        top:4px
      }

      @media (max-width: 460px) {
        paper-toolbar .bottom.title {
          font-size: 14px;
        }
      }
		</style>


    <iron-scroll-threshold
      class="flex scroll-hide" 
      on-lower-threshold="loadMoreData" 
      id="threshold">
      <iron-list class="scroll-hide" scroll-target="threshold" items="[[items]]">
	      <template>
					<div class="item">
						<div class="pad">
							<div class="primary">[[item.name]]</div>
							<div class="shortText">[[buildInfo(item)]]</div>
						</div>
            <template is="dom-if" if="[[hasDetail]]">
							<iron-icon id="[[item.id]]" values=[[item]] icon="chevron-right" on-tap="showDetail"></iron-icon>
            </template>
					</div>
	      </template>
  		</iron-list>
  	</iron-scroll-threshold>

  </template>
  <script>
    Polymer({
      is: 'things-mobile-list',

      behaviors: [
        Things.MobileListMetaBehavior
      ],

      properties: {
        items: {
          type: Array
        },

        infoFields: {
          type: Array,
          value: ['description']
        },

        lastPageIdx: {
          type: Number,
          value: 1
        },

        dataUrl: {
        	type: String
        },

        params: {
        	type: Object
        },

        metaData: {
        	type: Object
        },

        configured: {
        	type: Boolean
        },

        hasDetail: {
          type: Boolean,
          value: true
        }
      },

      listeners: {
        'things-list-configured': 'afterConfigured'
      },

      buildInfo: function(item) {
        // console.log(item);
        var infoValues = [];
        var infoFields = this.infoFields;
        for (var i in infoFields) {
          if (item.hasOwnProperty(infoFields[i])) {
            infoValues.push(item[infoFields[i]]);
          }
        }

        return infoValues.join(', ');
      },

      loadMoreData: function() {
        this.async(function() {
        	console.log('loading ' + limit + ' more...');
        	// TODO load next page

          this.$.threshold.clearTriggers();
        }, limit);
      },

      

      showDetail: function(e) {
        e.preventDefault();
        
				var url = '/' + this.metaData.menu.routing + '/detail';
				var target = e.target;
				var params = {
					metaData: this.metaData,
					values: target.values,
          gridEditorOnly: true
				};
				page(url, params);
      }
    })
  </script>
</dom-module>