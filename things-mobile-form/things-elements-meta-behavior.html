<!--
@license
Copyright (c) 2017, HatioLab Inc. All right reserved.
-->
<link rel="import" href="../../polymer/polymer.html">

<link rel="import" href="../../paper-input/paper-input.html">
<link rel="import" href="../../things-date-picker/things-date-picker.html">

<link rel="import" href="../things-mobile-resource-selector/things-mobile-resource-selector.html">


<script>

window.Things = window.Things || {};

/**
 *
 * @polymerBehavior Things.FieldsConstructorBehaviorImpl
 */
Things.ElementsMetaBehavior = {

	properties: {
		
	},
	
	_createElement: function(meta) {
		var newElement = null;

		var type = meta.type || meta.grid_editor;
		var fieldLabel = meta.label || meta.term;
		var codeName = meta.codeName || meta.ref_name;

		switch(type) {
    	case 'code-combo':
    	case 'resource-combo':
			newElement = document.createElement('things-mobile-resource-selector');
			newElement.setAttribute('code-name', codeName);
			newElement.setAttribute('name', meta.name);
			newElement.setAttribute('label', fieldLabel);
			newElement.setAttribute('resource-display-field', 'description');
			newElement.setAttribute('resource-type', 'CODE');
			break;

		// case 'resource-combo':
		// 	newElement = document.createElement('things-mobile-resource-selector');
		// 	newElement.setAttribute('code-name', codeName);
		// 	newElement.setAttribute('name', meta.name);
		// 	newElement.setAttribute('label', fieldLabel);
		// 	newElement.setAttribute('resource-type', 'RESOURCE');
		// 	break;

		case 'date-picker':
		case 'ranged-date-picker':
			newElement = document.createElement('things-date-picker');
			newElement.setAttribute('name', meta.name);
			newElement.setAttribute('label', fieldLabel);
			// newElement.setAttribute('placeholder', fieldLabel);

			if(meta.userData) {
				if(meta.userData.min) {
					newElement.setAttribute('min-date', meta.userData.min);
				}
				if(meta.userData.max) {
					newElement.setAttribute('max-date', meta.userData.max);
				}
			}

			break;

		case 'number':
			// newElement = document.createElement('things-number-field');
			newElement = document.createElement('paper-input');
			newElement.setAttribute('name', meta.name);
			newElement.setAttribute('placeholder', fieldLabel);
			newElement.setAttribute('label', fieldLabel);
			newElement.setAttribute('type', 'number');
			newElement.setAttribute('error', 'Input is not a number!');
			newElement.setAttribute('min', 0);
			break;

		case 'resource-selector':
			newElement = document.createElement('things-mobile-resource-selector');
			newElement.setAttribute('name', meta.name);
			newElement.setAttribute('label', fieldLabel);

			if (meta.userData) {
				var userData = meta.userData;
				newElement.setAttribute('resource-type', userData.resourceType.toUpperCase());
				newElement.setAttribute('resource-name', userData.resourceName);
				newElement.setAttribute('initial-params', userData.initialParams);
			} else if (meta.ref_type && meta.ref_name) {
				newElement.setAttribute('resource-type', meta.ref_type.toUpperCase());
				newElement.setAttribute('resource-name', meta.ref_name);
				// if (meta.ref_related) {
					// newElement.setAttribute('bind-fields', meta.ref_related);
					// newElement.setAttribute('bind-fields', ['name', 'description']);
				// }
				// if (meta.ref_params) {
				// 	newElement.setAttribute('initial-params', meta.ref_params);
				// }
			}

			break;

		default:
			newElement = document.createElement('paper-input');
			newElement.setAttribute('name', meta.name);
			newElement.setAttribute('label', fieldLabel);

			if(meta.hidden) {
				newElement.setAttribute('hidden', true);
			}

			if(meta.readonly) {
				newElement.setAttribute('readonly', true);
			}
		}

		if(!meta.searchForm && meta.userData) {
			if(meta.userData.required && !newElement.getAttribute('error-message')) {
				newElement.setAttribute('required', true);
				newElement.setAttribute('error-message', Things.DataGlobal.t('text.required_error'));
				newElement.setAttribute('auto-validate', true);
			}
		}

		if(!newElement) {
			return null;
		}

		newElement.setAttribute('class', 'flex style-scope things-form');
		if(meta.type != 'empty') {
			newElement.tabIndex = meta.tabindex >= 0 ? meta.tabindex : -1;
		}

		return newElement;
	}
};
</script>
