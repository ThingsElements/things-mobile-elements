<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->
<link rel="import" href="../../polymer/polymer.html">

<link rel="import" href="../../things-ajax/things-ajax.html">
<link rel="import" href="../../things-content/things-menu-content-behavior.html">

<link rel="import" href="../things-mobile-form/things-mobile-search-form.html">
<link rel="import" href="../things-mobile-list/things-mobile-list.html">



<dom-module id="things-mobile-content">
	<template>
		<style>
			:host {
				display: block;
				@apply(--layout-vertical);
				@apply(--layout-flex);
			}

			things-resource-grid {
				@apply(--layout-flex);
			}

			things-mobile-list {
				@apply(--layout-flex);
			}
		</style>

		<things-ajax
			auto
			id="menu-meta"
			method="GET"
			resource-url="[[menuMetaUrl]]"
			last-response="{{metaData}}">
		</things-ajax>

		<things-mobile-search-form
			page="{{page}}"
			limit="[[limit]]"
			form-fields="[[searchFormFields]]"
			select-fields="[[selectFields]]"
			sort-fields="[[sortFields]]"
			action-url="[[menuInfo.resource_url]]"
			last-response="{{lastResponse}}">
		</things-mobile-search-form>

		<things-mobile-list
			id="list"
			has-detail
			page="{{page}}"
			limit="[[limit]]"
			meta-data="[[metaData]]"
			items="[[items]]"
			class="flex"
			total-count="[[totalCount]]"
			on-next-page="queryNextPage">
		</things-mobile-list>

	</template>

	<script>
		Polymer({
			is: 'things-mobile-content',

			behaviors: [
				Things.MenuContentBehavior
			],

			properties: {
		        items: {
		          	type: Array,
		          	value: []
		        },

		        page: {
		        	type: Number,
		        	value: 1,
		        	notify: true
		        },

		        limit: {
		        	type: Number,
		        	value: 50
		        }, 

		        totalCount: {
		        	type: Number,
		        	value: 0
		        }
			},

			queryNextPage: function() {
				Polymer.dom(this).querySelector('#mobileSearchForm').submit();
			},

			/**
			 * 조회 데이터 변경시
			 * @param {Object} lastResponse
			 ******
			 */
			_responseChanged: function(lastResponse) {
				var items = (this.itemsProp && lastResponse[this.itemsProp]) ? lastResponse[this.itemsProp] : lastResponse;

				if (this.page > 1) {
					this.items = this.items.concat(items);
				} else {
					this.items = items;
				}

				this.totalCount = (this.totalProp && lastResponse[this.totalProp]) ? lastResponse[this.totalProp] : lastResponse.length;
			},
		});
	</script>
</dom-module>
